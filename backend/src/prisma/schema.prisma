generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Bet {
  id        Int      @id @default(autoincrement())
  event     String
  market    String
  stake     Float
  odds      Int
  status    String   @default("Pending")
  createdAt DateTime @default(now())
  imageUrl  String?
  link      String?
  eventId   String?
  rawText   String?

  // ðŸ‘‡ Add this line
  props BetProp[] // A bet can have multiple props
}

model ExpertAnalysis {
  id         Int      @id @default(autoincrement())
  expertName String
  createdAt  DateTime @default(now())
  filePath   String?
  parsedData Json
  summary    String?
  title      String?
  transcript String
}

model Player {
  id        Int      @id @default(autoincrement())
  espnId    String   @unique
  fullName  String
  position  String?
  team      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  stats     Stat[]
}

model Stat {
  id        Int      @id @default(autoincrement())
  playerId  Int
  season    Int
  category  String
  name      String
  label     String?
  value     Float
  createdAt DateTime @default(now())
  player    Player   @relation(fields: [playerId], references: [id])

  @@unique([playerId, season, name])
}

model NbaGame {
  id            Int      @id @default(autoincrement())
  espnId        String   @unique
  homeTeam      String
  awayTeam      String
  homeAbbr      String?
  awayAbbr      String?
  homeLogo      String?
  awayLogo      String?
  homeScore     Int?
  awayScore     Int?
  status        String?
  startTime     DateTime
  spread        Float?
  total         Float?
  moneylineHome Int?
  moneylineAway Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model BetProp {
  id          Int      @id @default(autoincrement())
  betId       Int
  playerName  String
  description String
  line        Float?
  outcome     String? // Pending | Hit | Miss
  currentStat Float?
  sheetRow    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  bet Bet @relation(fields: [betId], references: [id])

  @@unique([betId, description]) // prevent duplicate props for same bet
}
